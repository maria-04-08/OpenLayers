<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="./css/ol.css" rel="stylesheet" type="text/css" />
		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
		<script src="https://cdn.bootcss.com/openlayers/4.0.0/ol.js" type="text/javascript"></script>
		<!-- <script type="text/javascript" src="./js/ol.js" charset="utf-8"></script> -->
	</head>
	<style>
	body,html{
		height:100%;
		width:100%;
		overflow:hidden;
	}
  .map {
	width: 100%;
	height:100%;
  }
  #info{
	  position:fixed;
	  top:60px;
	  left:50%;
	  transform: translateX(-50%);
	  padding:4px 24px;
	  background:#fff;
	  color:#333;
	  border:1px solid #7B98BC;
	  font-weight:bold;
	}
	.toolbar{
		position:fixed;
		top:60px;
		left:2%;
		width:550px;
		height:80px;
		border-radius:8px;
		display: flex;
		justify-content: center;
		align-items:center;
		background:rgba(0,0,0,0.2);
		padding:0px 20px;
		box-sizing:border-box;
		
	}
	.toolbar span{
		display: block;
		width:30%;
		height:40px;
		text-align: center;
		line-height:40px;
		border-radius:4px;
		font-size:15px;
		background:rgba(255,255,255,0.5);
		margin-right:18px;
	}
	.toolbar span:hover{
		background:#fff;
		cursor: pointer;
	}
	.toolbar span.span-active{
		background:#fff;
	}
	#map {
		width: 100%;
		height: 100%;
		position: absolute;
	}
		 
	#menu {
		float: left;
		position: absolute;
		bottom: 50px;
		right: 30px;
		z-index: 2000;
	}
		 
	.checkbox {
		left: 20px;
	}
		 
	/**
	* 提示框的样式信息
	*/
	.tooltip {
		position: relative;
		background: rgba(0, 0, 0, 0.5);
		border-radius: 4px;
		color: white;
		padding: 4px 8px;
		opacity: 0.7;
		white-space: nowrap;
	}
		 
	.tooltip-measure {
		opacity: 1;
		font-weight: bold;
	}
		 
	.tooltip-static {
		background-color: #ffffff;
		color: black;
		border: 1px solid white;
	}
		 
	.tooltip-measure:before,
	.tooltip-static:before {
		border-top: 6px solid rgba(0, 0, 0, 0.5);
		border-right: 6px solid transparent;
		border-left: 6px solid transparent;
		content: "";
		position: absolute;
		bottom: -6px;
		margin-left: -7px;
		left: 50%;
	}
		 
	.tooltip-static:before {
		border-top-color: #ffffff;
	}
		 
	#scalebar {
		float: left;
		margin-bottom: 10px;
	}
	
	.map {
	  height: 100%;
	}
	.ol-popup {
	  position: absolute;
	  background-color: white;
	  -webkit-filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
	  filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
	  padding: 15px;
	  border-radius: 10px;
	  border: 1px solid #cccccc;
	  bottom: 12px;
	  left: -50px;
	  min-width: 280px;
	}
	.ol-popup:after, .ol-popup:before {
	  top: 100%;
	  border: solid transparent;
	  content: " ";
	  height: 0;
	  width: 0;
	  position: absolute;
	  pointer-events: none;
	}
	.ol-popup:after {
	  border-top-color: white;
	  border-width: 10px;
	  left: 48px;
	  margin-left: -10px;
	}
	.ol-popup:before {
	  border-top-color: #cccccc;
	  border-width: 11px;
	  left: 48px;
	  margin-left: -11px;
	}
	.ol-popup-closer {
	  text-decoration: none;
	  position: absolute;
	  top: 2px;
	  right: 8px;
	}
	.ol-popup-closer:after {
	  content: "✖";
	}
	</style>
	<body>
		<div id="map" class="map">
			<div id="menu">
				<label>测量类型选择</label>
				<select id="type">
					<option value="length">长度</option>
					<option value="area">面积</option>
				</select>
				<label class="checkbox label"><input type="checkbox" id="geodesic" />使用大地测量</label>
			</div>
			<div id="popup" class="ol-popup">
			  <a href="#" id="popup-closer" class="ol-popup-closer"></a>
			  <div id="popup-content" style="width:300px; height:120px;"></div>
			</div>
		</div>
		<div id="info"></div>
		<div class="toolbar">
			<!-- 默认点选 -->
			<span class='draw-line'>绘制</span><span class="measure-line">测距</span><span class="draw-grid">网格</span><span class="draw-logo">标志</span><span class="draw-pop">弹窗</span><span class="clear">清除</span>
		</div>
		<div id="scalebar"></div>
		<script>
			//全局变量
			var linerSource = '', lineLayer = '', lineDraw = '', measureSource = '', measureLayer = '', measureDraw = '',
				helpMsg = '',continueLineMsg = '',helpTooltipElement, measureTooltipElement, graticuleLayer = '', layerLogo = '',
				star1 = '', star2 = '', star3 = '', star4 = '', star5 = '', star6 = '', star7 = '', overlay = '';
			//-----------------------------------点选部分开始--------------------------------------------
			var style = new ol.style.Style({
			  fill: new ol.style.Fill({
			    color: 'rgba(255, 255, 255, 0.6)'
			  }),
			  stroke: new ol.style.Stroke({
			    color: '#319FD3',
			    width: 1
			  }),
			  text: new ol.style.Text({})
			});
			
			var raster = new ol.layer.Tile({
				source: new ol.source.OSM()
			});

			var vector = new ol.layer.Vector({
			  source: new ol.source.Vector({
				url: './china_diaoyudao.json',
				format: new ol.format.GeoJSON()
			  })
			});

			var select = new ol.interaction.Select();

			var translate = new ol.interaction.Translate({
			  features: select.getFeatures()
			});
			
			var layer_logo = new ol.layer.Vector({ //五角星展示
				source: new ol.source.Vector()
			});
			var map = new ol.Map({
				interactions: ol.interaction.defaults([
					select,
					translate
				]),
				layers: [raster, vector,layer_logo],
				target: 'map',
				view: new ol.View({
					center: [104.06, 30.67],
					projection: 'EPSG:4326',
					zoom: 4,
					minZoom:4
				})
			});
			
			var featureOverlay = new ol.layer.Vector({
			  source: new ol.source.Vector(),
			  map: map,
			  style: new ol.style.Style({
			    stroke: new ol.style.Stroke({
			      color: '#f00',
			      width: 1
			    }),
			    fill: new ol.style.Fill({
			      color: 'rgba(255,0,0,0.1)'
			    })
			  })
			});
			
			var highlight;
			var displayFeatureInfo = function(pixel) {
			
			var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
				return feature;
			});
			
			var info = document.getElementById('info');
				if (feature) {
					info.innerHTML = feature.getId() + ': ' + feature.get('name');
					$('#info').css({'display':'block'});
			} else {
				info.innerHTML = '&nbsp;';
				$('#info').css({'display':'none'});
			}
			if (feature !== highlight) {
			    if (highlight) {
			      featureOverlay.getSource().removeFeature(highlight);
			    }
			    if (feature) {
			      featureOverlay.getSource().addFeature(feature);
			    }
			    highlight = feature;
			  }
			
			};
			map.on('pointermove', function(evt) {
			  if (evt.dragging) {
			    return;
			  }
			  var pixel = map.getEventPixel(evt.originalEvent);
			  displayFeatureInfo(pixel);
			});
			
			map.on('click', function(evt) {
			  displayFeatureInfo(evt.pixel);
			});
			
			//------------------------------------点选部分结束--------------------------------------------
			
			//------------------------------------画线部分开始------------------------------------
			function drawLine(){
				// 添加一个绘制的线使用的layer
				linerSource = new ol.source.Vector();
				lineLayer = new ol.layer.Vector({
					source: linerSource,
					style: new ol.style.Style({
						stroke: new ol.style.Stroke({
							color: 'red',
							size: 1
						}),
						
					})
				})
				map.addLayer(lineLayer);
	
	// 			var lineDraw = map.addInteraction(new ol.interaction.Draw({
	// 				type: 'Polygon',
	// 				source: lineLayer.getSource()    // 注意设置source，这样绘制好的线，就会添加到这个source里
	// 			}));
				lineDraw = new ol.interaction.Draw({
					type: 'Polygon',
					source: lineLayer.getSource(),    // 注意设置source，这样绘制好的线，就会添加到这个source里
					style: new ol.style.Style({            // 设置绘制时的样式
						stroke: new ol.style.Stroke({
							color: 'green',
							size: 1
						}),
						fill: new ol.style.Fill({
						  color: 'rgba(255,0,0,0.1)'
						})
					}),
					// maxPoints: 4    // 限制不超过4个点
				});
				// 监听线绘制结束事件，获取坐标
				lineDraw.on('drawend', function(e){
					console.log('绘制完成 -----------');
					var _feature = e.feature;
					_feature.setStyle(new ol.style.Style({
					 stroke: new ol.style.Stroke({
						color: 'red',
						background:'#ccc',
						size: 1
					 }),
					 fill: new ol.style.Fill({
					   color: 'rgba(255,0,0,0.6)'
					 })
					}));
				});
				map.addInteraction(lineDraw);
			}

			//------------------------------------画线部分结束------------------------------------
			//动态加载js文件
			function loadJs(url,callback){
			 var script=document.createElement('script');
			 script.type="text/javascript";
			 if(typeof(callback)!="undefined"){
			 if(script.readyState){
			 script.onreadystatechange=function(){
			  if(script.readyState == "loaded" || script.readyState == "complete"){
			  script.onreadystatechange=null;
			  callback();
			  }
			 }
			 }else{
			 script.onload=function(){
			  callback();
			 }
			 }
			 }
			 script.src=url;
			 document.body.appendChild(script);
			 }
// 			 loadJs("https://cdn.bootcss.com/openlayers/4.0.0/ol.js",function(){
// 			 	console.log('替换成功');
// 			 });
			
			//------------------------------------测量距离开始------------------------------------
			function measure(){
				//定义矢量数据源
				var source = measureSource = new ol.source.Vector();
				//定义矢量图层
				var vector = measureLayer = new ol.layer.Vector({
				    source: source,
				    style: new ol.style.Style({
				        fill: new ol.style.Fill({
				            color:'rgba(255,255,255,0.2)'
				        }),
				        stroke: new ol.style.Stroke({
				            color: '#e21e0a',
				            width:2
				        }),
				        image: new ol.style.Circle({
				            radius: 5,
				            fill: new ol.style.Fill({
				                color:'#ffcc33'
				            })
				        })
				    })
				});
				//将矢量图层添加到地图中
				map.addLayer(vector);
				//添加比例尺控件
				var scaleLineControl = new ol.control.ScaleLine({
				    units: 'metric',
				    target: 'scalebar',
				    className: 'ol-scale-line'
				});
				map.addControl(scaleLineControl);
						 
						 
				//创建一个WGS84球体对象
				var wgs84Sphere = new ol.Sphere(6378137);
				//创建一个当前要绘制的对象
				var sketch = new ol.Feature();
				//创建一个帮助提示框对象
				// var helpTooltipElement;
				//创建一个帮助提示信息对象
				var helpTooltip;
				//创建一个测量提示框对象
				var measureTooltipElement;
				//创建一个测量提示信息对象
				var measureTooltip;
				//继续绘制多边形的提示信息
				var continuePolygonMsg = 'Click to continue drawing the polygon';
				//继续绘制线段的提示信息
				continueLineMsg = '点击继续画线';
						 
				//鼠标移动触发的函数
				var pointerMoveHandler = function (evt) {
				    //Indicates if the map is currently being dragged. 
				    //Only set for POINTERDRAG and POINTERMOVE events. Default is false.
				    //如果是平移地图则直接结束
				    if (evt.dragging) {
				        return;
				    }
				    //帮助提示信息
				    helpMsg = '点击画测量线';
						 
				    if (sketch) {
				        //Get the feature's default geometry. 
				        //A feature may have any number of named geometries.
				        //获取绘图对象的几何要素
				        var geom = sketch.getGeometry();
				        //如果当前绘制的几何要素是多边形，则将绘制提示信息设置为多边形绘制提示信息
				        //如果当前绘制的几何要素是多线段，则将绘制提示信息设置为多线段绘制提示信息
				        if (geom instanceof ol.geom.Polygon) {
				            helpMsg = continuePolygonMsg;
				        } else if (geom instanceof ol.geom.LineString) {
				            helpMsg = continueLineMsg;
				        }
				    }
				    //设置帮助提示要素的内标签为帮助提示信息
				    helpTooltipElement.innerHTML = helpMsg;
				    //设置帮助提示信息的位置
				    //The coordinate in view projection corresponding to the original browser event.
				    helpTooltip.setPosition(evt.coordinate);
				    //移除帮助提示要素的隐藏样式
				    $(helpTooltipElement).removeClass('hidden');
				};
						 
				//触发pointermove事件
				map.on('pointermove', pointerMoveHandler);
						 
				//当鼠标移除地图视图的时为帮助提示要素添加隐藏样式
				$(map.getViewport()).on('mouseout', function () {
				    $(helpTooltipElement).addClass('hidden');
				});
						 
				//获取大地测量复选框
				var geodesicCheckbox = document.getElementById('geodesic');
				//获取类型
				var typeSelect = document.getElementById('type');
				//定义一个交互式绘图对象
				var draw;
						 
				//添加交互式绘图对象的函数
				function addInteraction() {
				    // 获取当前选择的绘制类型
				    var type = typeSelect.value == 'area' ? 'Polygon' : 'LineString';
				    //创建一个交互式绘图对象
				    draw = new ol.interaction.Draw({
				        //绘制的数据源
				        source: source,
				        //绘制类型
				        type: type,
				        //样式
				        style: new ol.style.Style({
				            fill: new ol.style.Fill({
				                color:'rgba(255,255,255,0.2)'
				            }),
				            stroke: new ol.style.Stroke({
				                color: 'rgba(0,0,0,0.5)',
				                lineDash: [10, 10],
				                width:2
				            }),
				            image: new ol.style.Circle({
				                radius: 5,
				                stroke: new ol.style.Stroke({
				                    color:'rgba(0,0,0,0.7)'
				                }),
				                fill: new ol.style.Fill({
				                    color: 'rgba(255,255,255,0.2)'
				                })
				            })
				        })
				    });
					measureDraw = draw;
				    //将交互绘图对象添加到地图中
				    map.addInteraction(draw);
						 
				    //创建测量提示框
				    createMeasureTooltip();
				    //创建帮助提示框
				    createHelpTooltip();
						 
				    //定义一个事件监听
				    var listener;
				    //定义一个控制鼠标点击次数的变量
				    var count = 0;
				    //绘制开始事件
				    draw.on('drawstart', function (evt) {
				        //The feature being drawn.
				        sketch = evt.feature;
				        //提示框的坐标
				        var tooltipCoord = evt.coordinate;
				        //监听几何要素的change事件
				        //Increases the revision counter and dispatches a 'change' event.
						 
				        listener = sketch.getGeometry().on('change', function (evt) {
				            //The event target.
				            //获取绘制的几何对象
				            var geom = evt.target;
				            //定义一个输出对象，用于记录面积和长度
				            var output;
				            if (geom instanceof ol.geom.Polygon) {
				                map.removeEventListener('singleclick');
				                map.removeEventListener('dblclick');
				                //输出多边形的面积
				                output = formatArea(geom);
				                //Return an interior point of the polygon.
				                //获取多变形内部点的坐标
				                tooltipCoord = geom.getInteriorPoint().getCoordinates();
				            } else if (geom instanceof ol.geom.LineString) {
				                //输出多线段的长度
				                output = formatLength(geom);
				                //Return the last coordinate of the geometry.
				                //获取多线段的最后一个点的坐标
				                tooltipCoord = geom.getLastCoordinate();
				            }
				            
				            //设置测量提示框的内标签为最终输出结果
				            measureTooltipElement.innerHTML = output;
				            //设置测量提示信息的位置坐标
				            measureTooltip.setPosition(tooltipCoord);
				        });
				        
				        //地图单击事件
				        map.on('singleclick', function (evt) {
				            //设置测量提示信息的位置坐标，用来确定鼠标点击后测量提示框的位置
				            measureTooltip.setPosition(evt.coordinate);
				            //如果是第一次点击，则设置测量提示框的文本内容为起点
				            if (count == 0) {
				                measureTooltipElement.innerHTML = "起点";
				            }
				           //根据鼠标点击位置生成一个点
				            var point = new ol.geom.Point(evt.coordinate);
				            //将该点要素添加到矢量数据源中
				            source.addFeature(new ol.Feature(point));
				            //更改测量提示框的样式，使测量提示框可见
				            measureTooltipElement.className = 'tooltip tooltip-static';
				            //创建测量提示框
				            createMeasureTooltip();
				            //点击次数增加
				            count++;
				        });
						 
				        //地图双击事件
				        map.on('dblclick', function (evt) {
				            //根据
				            var point = new ol.geom.Point(evt.coordinate);
				            source.addFeature(new ol.Feature(point));
				        });
				    }, this);
				    //绘制结束事件
				    draw.on('drawend', function (evt) {
				        count = 0;
				        //设置测量提示框的样式
				        measureTooltipElement.className = 'tooltip tooltip-static';
				        //Set the offset for this overlay.
				        //设置偏移量
				        measureTooltip.setOffset([0, -7]);
				        //清空绘制要素
				        sketch = null;
				        //清空测量提示要素
				        measureTooltipElement = null;
				        //创建测量提示框
				        createMeasureTooltip();
				        //Removes an event listener using the key returned by on() or once().
				        //移除事件监听
				        ol.Observable.unByKey(listener);
				        //移除地图单击事件
				        map.removeEventListener('singleclick');
				    }, this);
				}
				//创建帮助提示框
				function createHelpTooltip() {
				    //如果已经存在帮助提示框则移除
				    if (helpTooltipElement) {
				        helpTooltipElement.parentNode.removeChild(helpTooltipElement);
				    }
				    //创建帮助提示要素的div
				    helpTooltipElement = document.createElement('div');
				    //设置帮助提示要素的样式
				    helpTooltipElement.className = 'tooltip hidden';
				    //创建一个帮助提示的覆盖标注
				    helpTooltip = new ol.Overlay({
				        element: helpTooltipElement,
				        offset: [15, 0],
				        positioning:'center-left'
				    });
				    //将帮助提示的覆盖标注添加到地图中
				    map.addOverlay(helpTooltip);
				}
				//创建测量提示框
				function createMeasureTooltip() {
				    //创建测量提示框的div
				    measureTooltipElement = document.createElement('div');
				    measureTooltipElement.setAttribute('id','lengthLabel');
				    //设置测量提示要素的样式
				    measureTooltipElement.className = 'tooltip tooltip-measure';
				    //创建一个测量提示的覆盖标注
				    measureTooltip = new ol.Overlay({
				        element: measureTooltipElement,
				        offset: [0, -15],
				        positioning:'bottom-center'
				    });
				    //将测量提示的覆盖标注添加到地图中
				    map.addOverlay(measureTooltip);
				}
				//测量类型发生改变时触发事件
				typeSelect.onchange = function () {
				    //移除之前的绘制对象
				    map.removeInteraction(draw);
				    //重新进行绘制
				    addInteraction();
				};
						 
				//格式化测量长度
				var formatLength = function (line) {
				    //定义长度变量
				    var length;
				    //如果大地测量复选框被勾选，则计算球面距离
				    if (geodesicCheckbox.checked) {
				        //Return the coordinates of the linestring.
				        //获取坐标串
				        var coordinates = line.getCoordinates();
				        //初始长度为0
				        length = 0;
				        //获取源数据的坐标系
				        var sourceProj = map.getView().getProjection();
				        //进行点的坐标转换
				        for (var i = 0; i < coordinates.length - 1; i++) {
				            //第一个点
				            var c1 = ol.proj.transform(coordinates[i], sourceProj, 'EPSG:4326');
				            //第二个点
				            var c2 = ol.proj.transform(coordinates[i + 1], sourceProj, 'EPSG:4326');
				            //获取转换后的球面距离
				            //Returns the distance from c1 to c2 using the haversine formula.
				            length += wgs84Sphere.haversineDistance(c1,c2);
				        }
				    } else {
				        //Return the length of the linestring on projected plane.
				        //计算平面距离
				        length = Math.round(line.getLength() * 100) / 100;
				    }
				    //定义输出变量
				    var output;
				    //如果长度大于1000，则使用km单位，否则使用m单位
				    if (length > 1000) {
				        output = (Math.round(length / 1000 * 100) / 100) + ' ' + 'km'; //换算成KM单位
				    } else {
				        output = (Math.round(length * 100) / 100) + ' ' + 'm'; //m为单位
				    }
				    return output;
				};
						 
				//格式化测量面积
				var formatArea = function (polygon) {
				    //定义面积变量
				    var area;
				    //如果大地测量复选框被勾选，则计算球面面积
				    if (geodesicCheckbox.checked) {
				        //获取初始坐标系
				        var sourceProj = map.getView().getProjection();
				        //Make a complete copy of the geometry.
				        //Transform each coordinate of the geometry from one coordinate reference system to another. 
				        //The geometry is modified in place. For example, a line will be transformed to a line and a circle to a circle.
				        //If you do not want the geometry modified in place, first clone() it and then use this function on the clone.
				        //克隆该几何对象然后转换坐标系
				        var geom = polygon.clone().transform(sourceProj, 'EPSG:4326');
				        //Return the Nth linear ring of the polygon geometry. 
				        //Return null if the given index is out of range. 
				        //The exterior linear ring is available at index 0 and the interior rings at index 1 and beyond.
				        //获取多边形的坐标系
				        var coordinates = geom.getLinearRing(0).getCoordinates();
				        //Returns the geodesic area for a list of coordinates.
				        //获取球面面积
				        area = Math.abs(wgs84Sphere.geodesicArea(coordinates));
				    } else {
				        //获取平面面积
				        area = polygon.getArea();
				    }
				    //定义输出变量
				    var output;
				    //当面积大于10000时，转换为平方千米，否则为平方米
				    if (area > 10000) {
				        output = (Math.round(area/1000000*100)/100) + ' ' + 'km<sup>2</sup>';
				    } else {
				        output = (Math.round(area*100)/100) + ' ' + 'm<sup>2</sup>';
				    }
				    return output;
				};
				//添加交互绘图对象
				addInteraction();
			}
			//------------------------------------测量距离结束------------------------------------
			
			//------------------------------------网格线开始--------------------------------------
			function drawGrid(){
				graticuleLayer = new ol.Graticule({
					strokeStyle: new ol.style.Stroke({
						color: 'rgba(12, 12, 12, 0.8)',
						width: 0.6
					}),
					targetSize: 80,
					text: new ol.style.Text({ //文本样式
						font: '12px Calibri,sans-serif',
						fill: new ol.style.Fill({
						  color: '#000'
						}),
						stroke: new ol.style.Stroke({
						  color: '#fff',
						  width: 3
						}),
						text:'666'
					})
				});
				console.log('kanyixia-----------'+JSON.stringify(graticuleLayer));
				graticuleLayer.setMap(map);
				
			}
			//------------------------------------网格线结束--------------------------------------
			
			//------------------------------------图标标注开始------------------------------------
// 			var layer2 = new ol.layer.Vector({
// 				source: new ol.source.Vector()
// 			  });
			
		function drawLogo(){
			// 添加一个五星
			star1 = new ol.Feature({
				geometry: new ol.geom.Point([104.06, 30.67])
			  });
			  star1.setStyle(new ol.style.Style({
				image: new ol.style.RegularShape({
				  points: 5,    // 顶点个数
				  radius1: 20, // 外圈大小
				  radius2: 10, // 内圈大小
				  stroke: new ol.style.Stroke({ // 设置边的样式
					  color: 'yellow',
					  size: 4
				  }),
				  fill: new ol.style.Fill({ // 设置五星填充样式
					  color: 'red'
				  })
				})
			  }));
			
			  layer_logo.getSource().addFeature(star1);
			  
			  star2 = new ol.Feature({
			  	geometry: new ol.geom.Point([116, 39])
			    });
			    star2.setStyle(new ol.style.Style({
			  	image: new ol.style.RegularShape({
			  	  points: 5,    // 顶点个数
			  	  radius1: 20, // 外圈大小
			  	  radius2: 10, // 内圈大小
			  	  stroke: new ol.style.Stroke({ // 设置边的样式
			  		  color: 'yellow',
			  		  size: 100
			  	  }),
			  	  fill: new ol.style.Fill({ // 设置五星填充样式
			  		  color: 'red'
			  	  })
			  	})
			    }));
				layer_logo.getSource().addFeature(star2);
				
				star3 = new ol.Feature({
					geometry: new ol.geom.Point([91, 29])
				  });
				  star3.setStyle(new ol.style.Style({
					image: new ol.style.RegularShape({
					  points: 5,    // 顶点个数
					  radius1: 20, // 外圈大小
					  radius2: 10, // 内圈大小
					  stroke: new ol.style.Stroke({ // 设置边的样式
						  color: 'yellow',
						  size: 100
					  }),
					  fill: new ol.style.Fill({ // 设置五星填充样式
						  color: 'red'
					  })
					})
				  }));
				  layer_logo.getSource().addFeature(star3);
				  
				  star4 = new ol.Feature({
				  	geometry: new ol.geom.Point([120, 30])
				    });
				    star4.setStyle(new ol.style.Style({
				  	image: new ol.style.RegularShape({
				  	  points: 5,    // 顶点个数
				  	  radius1: 20, // 外圈大小
				  	  radius2: 10, // 内圈大小
				  	  stroke: new ol.style.Stroke({ // 设置边的样式
				  		  color: 'yellow',
				  		  size: 100
				  	  }),
				  	  fill: new ol.style.Fill({ // 设置五星填充样式
				  		  color: 'red'
				  	  })
				  	})
				    }));
				    layer_logo.getSource().addFeature(star4);
					
					star5 = new ol.Feature({
						geometry: new ol.geom.Point([110, 20])
					  });
					  star5.setStyle(new ol.style.Style({
						image: new ol.style.RegularShape({
						  points: 5,    // 顶点个数
						  radius1: 20, // 外圈大小
						  radius2: 10, // 内圈大小
						  stroke: new ol.style.Stroke({ // 设置边的样式
							  color: 'yellow',
							  size: 100
						  }),
						  fill: new ol.style.Fill({ // 设置五星填充样式
							  color: 'red'
						  })
						})
					  }));
					  layer_logo.getSource().addFeature(star5);
					  
					  star6 = new ol.Feature({
					  	geometry: new ol.geom.Point([87, 43])
					    });
					    star6.setStyle(new ol.style.Style({
					  	image: new ol.style.RegularShape({
					  	  points: 5,    // 顶点个数
					  	  radius1: 20, // 外圈大小
					  	  radius2: 10, // 内圈大小
					  	  stroke: new ol.style.Stroke({ // 设置边的样式
					  		  color: 'yellow',
					  		  size: 100
					  	  }),
					  	  fill: new ol.style.Fill({ // 设置五星填充样式
					  		  color: 'red'
					  	  })
					  	})
					    }));
					    layer_logo.getSource().addFeature(star6);
						
						star7 = new ol.Feature({
							geometry: new ol.geom.Point([123, 50])
						  });
						  star7.setStyle(new ol.style.Style({
							image: new ol.style.RegularShape({
							  points: 5,    // 顶点个数
							  radius1: 20, // 外圈大小
							  radius2: 10, // 内圈大小
							  stroke: new ol.style.Stroke({ // 设置边的样式
								  color: 'yellow',
								  size: 100
							  }),
							  fill: new ol.style.Fill({ // 设置五星填充样式
								  color: 'red'
							  })
							})
						  }));
						  layer_logo.getSource().addFeature(star7);
		}

		//------------------------------------图标标注结束------------------------------------
		
		//------------------------------------展示弹窗开始------------------------------------
		function drawPop(){
			let container = document.getElementById('popup');
			let content = document.getElementById('popup-content');
			let closer = document.getElementById('popup-closer'); 
			// 要素信息框
			overlay = new ol.Overlay({
			    element: document.getElementById('popup'),
			    autoPan: true,
			    autoPanAnimation: {
			        duration: 250
			    }
			});
			map.on('click', function (evt) {
			    var pixel = map.getEventPixel(evt.originalEvent);
			    var feature = map.forEachFeatureAtPixel(pixel, function (feature, layer) {
			        return feature;
			    });
			    var coordinate = evt.coordinate;
			    var hdms = ol.coordinate.toStringHDMS(ol.proj.transform(
			        coordinate, 'EPSG:3857', 'EPSG:4326'));
			    if (feature !== undefined) {
			        content.innerHTML = '<p>你点击的坐标是：</p><code>' + hdms + '</code><p>这里属于：' + feature.get('name') + '</p>';
			    }
			    else {
			        content.innerHTML = '<p>你点击的坐标是：</p><code>' + hdms + '</code><p>这里是大海！</p>';
			    }
			    if(overlay){
			    	overlay.setPosition(coordinate);
			    	map.addOverlay(overlay);
			    }
			});
			
			/** 
			 * 隐藏弹出框的函数 
			 */
			closer.onclick = function () {
			    overlay.setPosition(undefined);
			    closer.blur();
			    return false;
			};
			
		}
		//------------------------------------展示弹窗结束------------------------------------
		//清除所有要素
		$('.clear').click(function(){
			removeAllFeatures('all');
		})
		$('.draw-line').click(function(){
			$(this).siblings().removeClass('span-active');
			$(this).addClass('span-active');
			drawLine();
		})
		$('.measure-line').click(function(){
			$(this).siblings().removeClass('span-active');
			$(this).addClass('span-active');
			measure();
		})
		$('.draw-grid').click(function(){
			$(this).siblings().removeClass('span-active');
			$(this).addClass('span-active');
			drawGrid();
		})
		$('.draw-logo').click(function(){
			$(this).siblings().removeClass('span-active');
			$(this).addClass('span-active');
			drawLogo();
		})
		$('.draw-pop').click(function(){
			$(this).siblings().removeClass('span-active');
			$(this).addClass('span-active');
			drawPop();
		})
		//清除元素
        function removeAllFeatures(type) {
            // map.removeInteraction();
			if(linerSource){
				linerSource.clear();
				map.removeLayer(lineLayer);
				map.removeInteraction(lineDraw);
			}
			if(measureSource){
				measureSource.clear();
				map.removeLayer(measureLayer);
				map.removeInteraction(measureDraw);
				if (helpTooltipElement) {
				    helpTooltipElement.parentNode.removeChild(helpTooltipElement);
					helpTooltipElement = '';
				}
				if($('.ol-overlaycontainer-stopevent').length>0){
					$('.ol-overlaycontainer-stopevent')[0].innerHTML = '';
				}
			}
			if(graticuleLayer){
// 				graticuleLayer = new ol.Graticule({
// 					strokeStyle: new ol.style.Stroke({
// 						color: 'rgba(12, 12, 12, 0)',
// 						width: 12
// 					}),
// 					targetSize: 0,
// 					text: new ol.style.Text({ //文本样式
// 						font: '12px Calibri,sans-serif',
// 						fill: new ol.style.Fill({
// 						  color: '#000'
// 						}),
// 						stroke: new ol.style.Stroke({
// 						  color: '#fff',
// 						  width: 3
// 						}),
// 						text:'666'
// 					})
// 				});
// 				graticuleLayer.setMap(map);
				var test = graticuleLayer.getMap();
//				console.log(test.targetSize);
			}
			if(star1){
				layer_logo.getSource().removeFeature(star1); 
				layer_logo.getSource().removeFeature(star2); 
				layer_logo.getSource().removeFeature(star3); 
				layer_logo.getSource().removeFeature(star4); 
				layer_logo.getSource().removeFeature(star5); 
				layer_logo.getSource().removeFeature(star6); 
				layer_logo.getSource().removeFeature(star7); 
			}
			if(overlay){
//				map.removeOverlay(overlay);
				overlay = '';
			}
        }
		
	</script>
		<!-- <script src="./js/map-utils.js" type="text/javascript"></script> -->
	</body>
</html>
