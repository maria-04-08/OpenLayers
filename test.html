<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="./css/ol.css" rel="stylesheet" type="text/css" />
		<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
		<script type="text/javascript" src="./js/ol.js" charset="utf-8"></script>
	</head>
	<style>
	body,html{
		height:100%;
		width:100%;
		overflow:hidden;
	}
	  .map {
	    width: 100%;
	    height:100%;
	  }
	  #info{
		  position:fixed;
		  top:100px;
		  left:20px;
	  }
	</style>
	<body>
		<div id="map" class="map"></div>
		<div id="info">&nbsp;</div>
		<script>
// 			import 'ol/ol.css';
// 			import Map from 'ol/Map';
// 			import View from 'ol/View';
// 			import GeoJSON from 'ol/format/GeoJSON';
// 			import VectorImageLayer from 'ol/layer/VectorImage';
// 			import VectorLayer from 'ol/layer/Vector';
// 			import VectorSource from 'ol/source/Vector';
// 			import {Fill, Stroke, Style, Text} from 'ol/style';
			
			
			var style = new ol.style.Style({
			  fill: new ol.style.Fill({
			    color: 'rgba(255, 255, 255, 0.6)'
			  }),
			  stroke: new ol.style.Stroke({
			    color: '#319FD3',
			    width: 1
			  }),
			  text: new ol.style.Text({})
			});
			
			var raster = new ol.layer.Tile({
				source: new ol.source.OSM()
			});

			var vector = new ol.layer.Vector({
			  source: new ol.source.Vector({
				url: './china_diaoyudao.json',
				format: new ol.format.GeoJSON()
			  })
			});

			var select = new ol.interaction.Select();

			var translate = new ol.interaction.Translate({
			  features: select.getFeatures()
			});

			var map = new ol.Map({
				interactions: ol.interaction.defaults([
					select,
					translate
				]),
				layers: [raster, vector],
				target: 'map',
				view: new ol.View({
					center: [104.06, 30.67],
					projection: 'EPSG:4326',
					zoom: 5
				})
			});
			
			
			
			// 添加一个绘制的线使用的layer
			var lineLayer = new ol.layer.Vector({
				source: new ol.source.Vector(),
				style: new ol.style.Style({
					stroke: new ol.style.Stroke({
						color: 'red',
						size: 1
					}),
					
				})
			})
			map.addLayer(lineLayer);

// 			var lineDraw = map.addInteraction(new ol.interaction.Draw({
// 				type: 'Polygon',
// 				source: lineLayer.getSource()    // 注意设置source，这样绘制好的线，就会添加到这个source里
// 			}));
			var lineDraw = new ol.interaction.Draw({
				type: 'Polygon',
				source: lineLayer.getSource(),    // 注意设置source，这样绘制好的线，就会添加到这个source里
				style: new ol.style.Style({            // 设置绘制时的样式
					stroke: new ol.style.Stroke({
						color: 'green',
						size: 1
					}),
					fill: new ol.style.Fill({
					  color: 'rgba(255,0,0,0.1)'
					})
				}),
				// maxPoints: 4    // 限制不超过4个点
			});
					// 监听线绘制结束事件，获取坐标
			lineDraw.on('drawend', function(e){
				console.log('绘制完成 -----------');
				var _feature = e.feature;
				_feature.setStyle(new ol.style.Style({
				 stroke: new ol.style.Stroke({
				 	color: 'red',
					background:'#ccc',
				 	size: 1
				 }),
				 fill: new ol.style.Fill({
				   color: 'rgba(255,0,0,0.6)'
				 })
				}));
			});
			map.addInteraction(lineDraw);
			
			var featureOverlay = new ol.layer.Vector({
			  source: new ol.source.Vector(),
			  map: map,
			  style: new ol.style.Style({
			    stroke: new ol.style.Stroke({
			      color: '#f00',
			      width: 1
			    }),
			    fill: new ol.style.Fill({
			      color: 'rgba(255,0,0,0.1)'
			    })
			  })
			});
			
			var highlight;
			var displayFeatureInfo = function(pixel) {
			
			  var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
			    return feature;
			  });
			
			  var info = document.getElementById('info');
			  if (feature) {
			    info.innerHTML = feature.getId() + ': ' + feature.get('name');
			  } else {
			    info.innerHTML = '&nbsp;';
			  }
			
			  if (feature !== highlight) {
			    if (highlight) {
			      featureOverlay.getSource().removeFeature(highlight);
			    }
			    if (feature) {
			      featureOverlay.getSource().addFeature(feature);
			    }
			    highlight = feature;
			  }
			
			};
			
			map.on('pointermove', function(evt) {
			  if (evt.dragging) {
			    return;
			  }
			  var pixel = map.getEventPixel(evt.originalEvent);
			  displayFeatureInfo(pixel);
			});
			
			map.on('click', function(evt) {
			  displayFeatureInfo(evt.pixel);
			});
		</script>
	</body>
</html>
