<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="./css/ol.css" rel="stylesheet" type="text/css" />
		<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
		<script type="text/javascript" src="./js/ol.js" charset="utf-8"></script>
	</head>
	<style>
	body,html{
		height:100%;
		width:100%;
		overflow:hidden;
	}
	  .map {
	    width: 100%;
	    height:100%;
	  }
	  #info{
		  position:fixed;
		  top:100px;
		  left:20px;
	  }
	</style>
	<body>
		<div id="map" class="map"></div>
		<div id="info">&nbsp;</div>
		<script>
// 			import 'ol/ol.css';
// 			import Map from 'ol/Map';
// 			import View from 'ol/View';
// 			import GeoJSON from 'ol/format/GeoJSON';
// 			import VectorImageLayer from 'ol/layer/VectorImage';
// 			import VectorLayer from 'ol/layer/Vector';
// 			import VectorSource from 'ol/source/Vector';
// 			import {Fill, Stroke, Style, Text} from 'ol/style';
			
			
			var style = new ol.style.Style({
			  fill: new ol.style.Fill({
			    color: 'rgba(255, 255, 255, 0.6)'
			  }),
			  stroke: new ol.style.Stroke({
			    color: '#319FD3',
			    width: 1
			  }),
			  text: new ol.style.Text({})
			});
			
			var raster = new ol.layer.Tile({
				source: new ol.source.OSM()
			});

			var vector = new ol.layer.Vector({
			  source: new ol.source.Vector({
				url: './china_diaoyudao.json',
				format: new ol.format.GeoJSON()
			  })
			});

			var select = new ol.interaction.Select();

			var translate = new ol.interaction.Translate({
			  features: select.getFeatures()
			});

			var map = new ol.Map({
				interactions: ol.interaction.defaults([
					select,
					translate
				]),
				layers: [raster, vector],
				target: 'map',
				view: new ol.View({
					center: [104.06, 30.67],
					projection: 'EPSG:4326',
					zoom: 5
				})
			});
			
			var addresult=addSector([116.28, 39.54]);//传入经纬度
    function addSector(coord){
 
        var origi_point = ol.proj.transform(coord, 'EPSG:4326', 'EPSG:3857');//根据经纬度生成圆点
        //调用自定义的写好的生成扇形的 方法          //圆心    半径      边数 弧度 方向角(以y周围0)(可以自定义自己的x周一样)
        var points = createRegularPolygonCurve(origi_point, 1000000, 100,30,90);
 
        var iconFeature = new ol.Feature({
            geometry: points,
            population: 4000,
            //rainfall: 500
        });
 
        var iconStyle = new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'red',
                lineDash: [0],
                width: 2
            }),
            fill: new ol.style.Fill({
                color: 'rgba(0, 0, 255, 0.2)'
            })
        });
        //iconStyle.getImage().setScale(0.3);
        iconFeature.setStyle(iconStyle);
        var vectorSource = new ol.source.Vector({
            features: [iconFeature]
        });
 
        var vectorLayer = new ol.layer.Vector({
            source: vectorSource
        });
        map.addLayer(vectorLayer);
        return {feature:iconFeature,layer:vectorLayer,sourceVector:vectorSource,point:coord};
    }                                   //圆心    半径  边数  弧度  方向角
    function createRegularPolygonCurve(origin, radius, sides,r,angel) {
 
 
        var rotation = 360 - r;
        var angle = Math.PI * ((1/sides) - (1/2));
        if(rotation) {
            angle += (rotation / 180) * Math.PI;
        }
        var rotatedAngle, x, y;
        var points = [];
        for(var i=0; i<sides; ++i) {
            var an = i*((360 - rotation)/360);
            rotatedAngle = angle + (an * 2 * Math.PI / sides);
            x = origin[0] + (radius * Math.cos(rotatedAngle));
            y = origin[1] + (radius * Math.sin(rotatedAngle));
            points.push([x,y]);
        }
        if(rotation!=0){
            points.push(origin);
        }
        var ring = new ol.geom.LinearRing(points);
        ring.rotate(Math.PI-((angel-r/2)/180)*Math.PI,origin);
        var poy = new ol.geom.Polygon([points]);
        var a = ring.A;
        poy.A=a;
 
        return poy;
    }
			
// 			// 添加一个绘制的线使用的layer
// 			var lineLayer = new ol.layer.Vector({
// 				source: new ol.source.Vector(),
// 				style: new ol.style.Style({
// 					stroke: new ol.style.Stroke({
// 						color: 'red',
// 						size: 1
// 					})
// 				})
// 			})
// 			map.addLayer(lineLayer);
// 
// 			map.addInteraction(new ol.interaction.Draw({
// 				type: 'LineString',
// 				source: lineLayer.getSource()    // 注意设置source，这样绘制好的线，就会添加到这个source里
// 			}));
				
			// 添加绘图的交互类
// 			map.addInteraction(new ol.interaction.Draw({
// 				type: 'LineString' // 设置绘制线
// 			}));
				
// 			var map = new ol.Map({
// 				layers: [
// 					new ol.layer.Vector({
// 					  imageRatio: 2,
// 					  source: new ol.source.Vector({
// 						url: './china_diaoyudao.json',
// 						format: new ol.format.GeoJSON()
// 					  }),
// 					  style: function(feature) {
// 						style.getText().setText(feature.get('name'));
// 						return style;
// 					  }
// 					})
// 			  ],
// 			  target: 'map',
// 			  view: new ol.View({ 
// 			    center: [108,20],
// 			    zoom: 3,
// 				minZoom: 3,
// 				maxZoom: 10
// 			  })
// 			});
			
			var featureOverlay = new ol.layer.Vector({
			  source: new ol.source.Vector(),
			  map: map,
			  style: new ol.style.Style({
			    stroke: new ol.style.Stroke({
			      color: '#f00',
			      width: 1
			    }),
			    fill: new ol.style.Fill({
			      color: 'rgba(255,0,0,0.1)'
			    })
			  })
			});
			
			var highlight;
			var displayFeatureInfo = function(pixel) {
			
			  var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
			    return feature;
			  });
			
			  var info = document.getElementById('info');
			  if (feature) {
			    info.innerHTML = feature.getId() + ': ' + feature.get('name');
			  } else {
			    info.innerHTML = '&nbsp;';
			  }
			
			  if (feature !== highlight) {
			    if (highlight) {
			      featureOverlay.getSource().removeFeature(highlight);
			    }
			    if (feature) {
			      featureOverlay.getSource().addFeature(feature);
			    }
			    highlight = feature;
			  }
			
			};
			
			map.on('pointermove', function(evt) {
			  if (evt.dragging) {
			    return;
			  }
			  var pixel = map.getEventPixel(evt.originalEvent);
			  displayFeatureInfo(pixel);
			});
			
			map.on('click', function(evt) {
			  displayFeatureInfo(evt.pixel);
			});
		</script>
	</body>
</html>
